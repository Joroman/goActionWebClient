angular.module("myApp",["ui.router","ngResource","nvd3","chart.js","ngDialog"]).config(["$stateProvider","$urlRouterProvider","ChartJsProvider",function(e,t,o){o.setOptions("line",{chartColors:["#5cb85c","#FF7E67"],responsive:!0}),e.state("app",{url:"/",views:{header:{templateUrl:"views/header.html",controller:"HeaderController"},content:{templateUrl:"views/home.html",controller:"HeaderController"}}}).state("app.activeActions",{url:"active",views:{"content@":{templateUrl:"views/active_actions.html",controller:"ActionsController"}}}).state("app.getStartAction",{url:"getStart",views:{"content@":{templateUrl:"views/getstart_action.html",controller:"GetStartController"}}}).state("app.editAction",{url:"defined/:id",views:{"content@":{templateUrl:"views/edit_action.html",controller:"EditActionController"}}}).state("app.editPros",{url:"prospection/:id",views:{"content@":{templateUrl:"views/edit_pros.html",controller:"EditActionController"}}}).state("app.editReq",{url:"request/:id",views:{"content@":{templateUrl:"views/edit_req.html",controller:"EditActionController"}}}).state("app.editRes",{url:"respond:id",views:{"content@":{templateUrl:"views/edit_res.html",controller:"EditActionController"}}}).state("app.closeActions",{url:"close",views:{"content@":{templateUrl:"views/close_actions.html",controller:"CloseActionController"}}}).state("app.closeActions.detail",{url:"detail:id",views:{"content@":{templateUrl:"views/close_detail.html",controller:"CloseDetailController"}}}).state("app.clients",{url:"clients",views:{"content@":{templateUrl:"views/clients.html",controller:"ClientsController"}}}).state("app.clients.contacts",{url:"contacts:id",views:{"content@":{templateUrl:"views/contacts.html",controller:"ContactsController"}}}).state("app.sales",{url:"sales",views:{"content@":{templateUrl:"views/sales.html",controller:"SalesControllerDonut"}}}),t.otherwise("/")}]),angular.module("myApp").controller("ActionsController",["$scope","actionsService","clientsService",function(e,t,o){t.getActions().query(function(t){e.actions=t,n()},function(t){console.log("aqui es."),e.message="Error"+t.status+t.statusText}),e.titleDef="Defined Actions",e.actionsDef=[],e.titlePros="Prospect Actions",e.actionsPro=[],e.titleReq="Request Acitons",e.actionsReq=[],e.titleRes="Response Actions",e.actionsRes=[],e.table_header=["Create Action","Action Name","Client","Finish Date","Detail"],e.table_header_pros=["Action Name","Client","Contact","Objective","Meeting","Detail"],e.table_header_req=["Action Name","Client","Contact","Service/Product","Estimate Budget","Date Response","Detail"],e.table_header_res=["Client","Offer Name","Offer Document","Offer budget","Offer margin","Send Date","Detail"],e.def=!0,e.def_color="panel-success",e.pros=!1,e.pros_color="panel-info",e.req=!1,e.req_color="panel-info",e.res=!1,e.res_color="panel-info";var n=function(){angular.forEach(e.actions,function(t){null==t.feedback&&null==t.response&&null==t.request&&null==t.prospection&&e.actionsDef.push(t),null==t.feedback&&null==t.response&&null==t.request&&null!=t.prospection&&e.actionsPro.push(t),null==t.feedback&&null==t.response&&null!=t.request&&null!=t.prospection&&e.actionsReq.push(t),null==t.feedback&&null!=t.response&&null!=t.request&&null!=t.prospection&&e.actionsRes.push(t)}),e.num_def=e.actionsDef.length,e.num_pros=e.actionsPro.length,e.num_req=e.actionsReq.length,e.num_res=e.actionsRes.length};e.changeToDefined=function(){e.def=!0,e.def_color="panel-success",e.pros=!1,e.pros_color="panel-info",e.req=!1,e.req_color="panel-info",e.res=!1,e.res_color="panel-info"},e.changeToProspect=function(){e.def=!1,e.def_color="panel-info",e.pros=!0,e.pros_color="panel-success",e.req=!1,e.req_color="panel-info",e.res=!1,e.res_color="panel-info"},e.changeToRequest=function(){e.def=!1,e.def_color="panel-info",e.pros=!1,e.pros_color="panel-info",e.req=!0,e.req_color="panel-success",e.res=!1,e.res_color="panel-info"},e.changeToResponse=function(){e.def=!1,e.def_color="panel-info",e.pros=!1,e.pros_color="panel-info",e.req=!1,e.req_color="panel-info",e.res=!0,e.res_color="panel-success"}}]).controller("CloseActionController",["$scope","actionsService","$state",function(e,t,o){function n(e){for(var t=[],o=0;o<e.length;o++)null!=e[o].feedback&&t.push(e[o]);return t}function a(t){var o=[];console.log("AÃ‘O :"+e.year),console.log(t);for(var n=0;n<t.length;n++)e.year===new Date(t[n].feedback.project_start_date).getFullYear()&&(o.push(t[n]),console.log("entro"));return console.log(o),o}function s(t){if(e.actionsLoseYear=[],e.actionsWinYear=[],t.length>0){for(var o=0;o<t.length;o++)t[o].feedback.offer_win===!0?e.actionsWinYear.push(t[o]):e.actionsLoseYear.push(t[o]);e.numActionsWin=e.actionsWinYear.length,e.numActionsLose=e.actionsLoseYear.length}else e.numActionsWin=0,e.numActionsLose=0}function i(t,o){var n;n=1==o?0:1;for(var a=0;a<12;a++){for(var s=0,i=0;i<t.length;i++)a===new Date(t[i].feedback.project_start_date).getMonth()&&s++;e.data[n][a]=s}console.log("data ...."),console.log(e.data)}e.table_header_win=["Date Sale","Client","Contact","Import","Marign","Details"],e.table_header_lose=["Close Date","Client","Contact","Details"];var l=[];e.actionsLoseYear=[],e.actionsWinYear=[],e.year=(new Date).getFullYear(),e.data=new Array(2),e.data=function(e){for(var t=0;t<2;t++)e[t]=new Array(12);return e}(e.data),t.getActions().query().$promise.then(function(t){l=n(t),l=a(l),e.numActionClose=l.length,s(l),i(e.actionsWinYear,!0),i(e.actionsLoseYear,!1),console.log("SORT"),console.log(e.actionsWinYear),console.log(e.actionsLoseYear)},function(t){e.message="Error: "+response.status+" "+response.statusText}),e.newYear=function(){t.getActions().query().$promise.then(function(t){e.year=new Date(e.year).getFullYear(),l=n(t),l=a(l),e.numActionClose=l.length,s(l),i(e.actionsWinYear,!0),i(e.actionsLoseYear,!1),console.log("SORT 2"),console.log(e.actionsWinYear),console.log(e.actionsLoseYear)},function(t){e.message="Error: "+response.status+" "+response.statusText})},e.labels=["January","February","March","April","May","June","July","August","September","October","November","Dicember"],e.series=["Actions Win","Actions Lose"],e.onClick=function(e,t){console.log(e,t)},e.detail=function(e){o.go("app.closeActions.detail",{id:e._id})}}]).controller("CloseDetailController",["$scope","actionsService","$stateParams",function(e,t,o){o.id?e.id=o.id:e.id=0,t.getActions().get({id:e.id},function(t){e.action=t,console.log(e.action)})}]).controller("GetStartController",["$scope","$state","actionsService","clientsService",function(e,t,o,n){e.action={name:"",description:"",_client:"",end_date:new Date,start_date:new Date,client_name:""},e.getStart=!0,e.save=function(){console.log("action"),console.log(e.action),o.getActions().post(e.action,function(e){t.go("app.activeActions")})},e.clients=n.getClients().query(function(t){e.clients=t,e.clients.length>0&&(e.getStart=!0),e.clients.lenght<0&&(e.getStart=!1)}),e.getClients=function(){n.getClients().query(function(t){e.clients=t,e.clients.length>0&&(e.getStart=!0)}),e.clientChose=function(t){e.client=t,e.action.client_name=t.company_name,e.action._client=t._id}}}]).controller("EditActionController",["$state","$scope","actionsService","panelService","$stateParams","salesService","clientsService",function(e,t,o,n,a,s,i){function l(t){var o={};o.contact=t.prospection.contact,o._action=t._id,o.project_price=t.response.offer_budget,o.project_margin=t.response.offer_margin,o.sales_date=t.feedback.project_start_date,i.getClients().get({id:t._client},function(t){o._client=t.company_name,console.log("apunto del post sales"),console.log(t),console.log(o),s.getSales().post(o,function(t){console.log(t),e.go("app.closeActions")})})}function c(e){return"app.editAction"==t.name_state&&(t.action.start_date=new Date(e.start_date),t.action.end_date=new Date(e.end_date)),"app.editPros"==t.name_state&&(t.action.start_date=new Date(e.start_date),t.action.end_date=new Date(e.end_date),t.action.prospection.meeting_date=new Date(e.prospection.meeting_date)),"app.editReq"==t.name_state&&(t.action.start_date=new Date(e.start_date),t.action.end_date=new Date(e.end_date),t.action.prospection.meeting_date=new Date(e.prospection.meeting_date),t.action.request.response_date=new Date(e.request.response_date)),"app.editRes"==t.name_state&&(t.action.start_date=new Date(e.start_date),t.action.end_date=new Date(e.end_date),t.action.prospection.meeting_date=new Date(e.prospection.meeting_date),t.action.request.response_date=new Date(e.request.response_date),t.action.response.date_send=new Date(e.response.date_send),t.action.feedback={},t.action.feedback.offer_win="false",console.log(t.action.feedback.offer_win)),e}t.show_act=!0,t.show_edit=!1,t.show_create=!1,t.show_close=!1,t.name_state=e.current.name,a.id?t.id=a.id:t.id=0,console.log(t.id),console.log(a);var r=n.getPanels();t.show=function(){t.show_act=!1,t.show_edit=!0,t.show_create=!1,t.show_close=!1},t.showClose=function(){t.show_act=!1,t.show_edit=!1,t.show_create=!1,t.show_close=!0},t.show1=function(){t.show_act=!0,t.show_edit=!1,t.show_create=!1,t.show_close=!1},t.show2=function(){t.show_act=!1,t.show_edit=!1,t.show_create=!0,t.show_close=!1},"app.editAction"==t.name_state&&(t.panels=r.slice(0,2),t.panels[0].color="panel-info",t.panels[0].show=t.show1,t.panels[1].color="panel-success",t.panels[1].show=t.show2,t.textButton="Edit Defined"),"app.editPros"==t.name_state&&(t.panels=r.slice(0,3),t.panels[0].color="panel-info",t.panels[0].show=t.show1,t.panels[1].color="panel-info",t.panels[1].show=t.show1,t.panels[2].color="panel-success",t.panels[2].show=t.show2,t.textButton="Edit Prospect"),"app.editReq"==t.name_state&&(t.panels=r,t.panels[0].color="panel-info",t.panels[0].show=t.show1,t.panels[1].color="panel-info",t.panels[1].show=t.show1,t.panels[2].color="panel-info",t.panels[2].show=t.show1,t.panels[3].color="panel-success",t.panels[3].show=t.show2,t.textButton="Edit Request"),"app.editRes"==t.name_state&&(t.panels=r,t.panels[0].color="panel-info",t.panels[0].show=t.show1,t.panels[1].color="panel-info",t.panels[1].show=t.show1,t.panels[2].color="panel-info",t.panels[2].show=t.show1,t.panels[3].color="panel-info",t.panels[3].show=t.show1,t.textButton="Edit Response"),o.getActions().get({id:t.id},function(e){t.action=e,console.log(t.action),t.action=c(t.action),console.log("action with date"),console.log(t.action)}),t.update=function(){o.getActions().update({id:t.id},t.action)},t.saveNew=function(){o.getActions().delete({id:t.id},function(){o.getActions().post(t.action,function(){"app.editAction"==t.name_state&&e.go("app.editPros",{id:t.id}),"app.editPros"==t.name_state&&e.go("app.editReq",{id:t.id}),"app.editReq"==t.name_state&&e.go("app.editRes",{id:t.id}),"app.editRes"==t.name_state&&e.go("app.closeActions")})})},t.close=function(){"app.editRes"!=t.name_state?(t.action.feedback.offer_win=!1,t.action.feedback.project_start_date=new Date):"false"==t.action.feedback.offer_win&&(t.action.feedback.project_start_date=new Date),o.getActions().delete({id:t.id},function(){o.getActions().post(t.action,function(t){t.feedback.offer_win===!0?(console.log("entre para grabar sales"),l(t),e.go("app.closeActions")):e.go("app.closeActions")})})},t.getContacts=function(){i.getClients().get({id:t.action._client},function(e){t.client=e})},t.contactChose=function(e){t.action.prospection={},t.action.prospection.contact=e.name+" "+e.category+" "+e.phone+" "+e.email}}]).controller("ClientsController",["$scope","clientsService",function(e,t){e.client={_id:"0",company_name:"",direction:"",city:"",country:"",phone:"",email:"",contacts:[]},t.getClients().query(function(t){e.clients=t,console.log(e.clients)}),console.log(e.clients),e.createClient=function(){t.getClients().save(e.client),e.returnClients()},e.updateClient=function(o){t.getClients().update({id:o},e.client,function(){t.getClients().query(function(t){e.clients=t})})},e.choseClient=function(t){var o=e.clients.indexOf(t);e.client=e.clients[o]},e.returnClients=function(){t.getClients().query(function(t){e.clients=t,e.client={}})},e.deleteClient=function(){t.getClients().delete({id:e.client._id},function(){t.getClients().query(function(t){e.clients=t,e.client={}})})}}]).controller("ContactsController",["$scope","clientsService","$stateParams",function(e,t,o){o.id?e.id=o.id:e.id=0,e.client=t.getClients().get({id:e.id}).$promise.then(function(t){e.client=t},function(t){e.message="Error: "+t.status+" "+t.statusText}),e.getClient=function(){e.client=t.getClients().get({id:e.id}).$promise.then(function(t){e.client=t},function(t){e.message="Error: "+t.status+" "+t.statusText})},console.log("CLIENT CONTACTS"),console.log(e.client),e.updateClientContact=function(){console.log("UPDATE COntact Client"),console.log(e.client),t.getClients().update({id:e.id},e.client)},e.deleteContact=function(){if(null!=e.contact){var o=e.client.contacts.indexOf(e.contact);console.log("CONTACTA"),console.log(e.contact),console.log("CLIENT"),console.log(e.client),console.log(o),o!=-1&&(e.client.contacts.splice(o,1),console.log(e.id),t.getClients().update({id:e.id},e.client),e.contact={})}},e.newContact=function(){null==e.client.contacts&&(e.client.contacts=[]),e.client.contacts.push(e.contact),t.getClients().delete({id:e.id},function(){t.getClients().save(e.client,function(t){e.client=t,e.contact={}})})},e.takeContact=function(t){e.contact=t}}]).controller("SalesControllerDonut",["$scope","salesService","clientsService",function(e,t,o){e.data=[],e.year=new Date,t.getSales().query().$promise.then(function(e){a(e,n(e)),console.log("OLLLLLLLEEEEEEEEEEEE")},function(t){e.message="Error: "+t.status+" "+t.statusText});var n=function(e){var t=[];if(e.length>0)for(var o=0;o<e.length;o++)t.indexOf(e[o]._client)==-1&&t.push(e[o]._client);return console.log("lista clientes"),console.log(t),t},a=function(t,o){for(var n=0;n<o.length;n++){for(var a=0,s=0;s<t.length;s++)o[n].indexOf(t[s]._client)!=-1&&e.year.getFullYear()===new Date(t[s].sales_date).getFullYear()&&(console.log(e.year.getFullYear()),console.log(new Date(t[s].sales_date).getFullYear()),a+=t[s].project_price,console.log(a));a>0&&(console.log(o[n]),e.data.push({key:o[n],y:a}))}};e.options={chart:{type:"pieChart",height:350,donut:!0,x:function(e){return e.key},y:function(e){return e.y},showLabels:!0,pie:{startAngle:function(e){return e.startAngle-Math.PI},endAngle:function(e){return e.endAngle-Math.PI}},duration:500,legend:{margin:{top:10,right:50,bottom:10,left:0}}}}}]).controller("SalesAreaCharController",["$scope","salesService",function(e,t){function o(e){var t=[],o=["#bcbd22","#1f77b4","#5cb85c","#FF7E67","#f0ad4e"],n=0;e.length!=-1&&(n=e.length),n>5&&(n=5);for(var a=0;a<n;a++){for(var s=[],i=e[a].salesObject,l=0;l<=11;){for(var c=0,r=0;r<i.length;r++)console.log(new Date(i[r].sales_date).getMonth()),l===new Date(i[r].sales_date).getMonth()&&(c+=i[r].project_price);l++,s.push({x:l,y:c})}t[a]={key:e[a].client,color:o[a],values:s}}return console.log(t),t}var n=[];e.year=new Date,e.yearText=e.year.getFullYear(),t.getSales().query().$promise.then(function(t){var i;console.log("sales:::"),console.log(t),n=a(t),i=s(t,n),e.data=o(i)},function(t){e.message="Error: "+response.status+" "+response.statusText});var a=function(e){var t=[];if(console.log("lista clientes0000"),e.length>0){console.log("lista clientes1111");for(var o=0;o<e.length;o++)t.indexOf(e[o]._client)==-1&&t.push(e[o]._client)}return console.log("lista clientes22222"),console.log(t),t},s=function(t,o){var n=[],a=[],s=0,i=[];if(o.length>0){for(var l=0;l<o.length;l++){s=0,i=[];for(var c=0;c<t.length;c++)o[l]===t[c]._client&&e.year.getFullYear()===new Date(t[c].sales_date).getFullYear()&&(s+=t[c].project_price,i.push(t[c]));a.push({client:o[l],totalSales:s,salesObject:i})}n=a.sort(function(e,t){return t.totalSales-e.totalSales})}return console.log("SalesClientList:"),console.log(a),n};e.getSales=function(){e.year=new Date(e.yearText),console.log("entroo"+e.year),t.getSales().query().$promise.then(function(t){var i;console.log("sales:::"),console.log(t),n=a(t),i=s(t,n),e.data=o(i)},function(t){e.message="Error: "+response.status+" "+response.statusText})},e.options={chart:{type:"multiBarChart",height:450,margin:{top:50,right:20,bottom:45,left:80},clipEdge:!0,duration:500,stacked:!0,xAxis:{axisLabel:"Month",showMaxMin:!1,tickFormat:function(e){return d3.format(",f")(e)}},yAxis:{axisLabel:"Sales",axisLabelDistance:-20,tickFormat:function(e){return d3.format(",.1f")(e)}}}}}]).controller("SalesControllerLineChart",["$scope","salesService",function(e,t){e.data=[],e.date=new Date,e.dateText=e.date.getFullYear(),t.getSales().query().$promise.then(function(t){e.data=o(t)},function(t){e.message="Error: "+t.status+" "+t.statusText});var o=function(t){for(var o=[],n=[],a=0;a<=11;){for(var s=0,i=0;i<t.length;i++)a===new Date(t[i].sales_date).getMonth()&&e.date.getFullYear()===new Date(t[i].sales_date).getFullYear()&&(s+=t[i].project_price);a++,n.push({x:a,y:s})}return o.push({key:"Sales",color:"#5cb85c",values:n}),o};e.changeYear=function(){t.getSales().query().$promise.then(function(t){e.date=new Date(e.dateText),e.data=o(t)},function(t){e.message="Error: "+t.status+" "+t.statusText})},e.options={chart:{type:"multiBarChart",height:400,margin:{top:50,right:20,bottom:45,left:80},clipEdge:!0,duration:500,stacked:!0,xAxis:{axisLabel:"Month",showMaxMin:!1,tickFormat:function(e){return d3.format(",f")(e)}},yAxis:{axisLabel:"Sales",axisLabelDistance:-20,tickFormat:function(e){return d3.format(",.1f")(e)}}}}}]).controller("SalesChartController",["$scope","salesService",function(e,t){function o(e){for(var t=0;t<2;t++)e[t]=new Array(12);return e}e.year=(new Date).getFullYear(),e.labels=["January","February","March","April","May","June","July","August","September","October","November","Dicember"],e.data=new Array(2),e.data=o(e.data),e.series=[],e.onClick=function(e,t){console.log(e,t)},t.getSales().query().$promise.then(function(t){e.data=n(t)},function(t){e.message="Error: "+response.status+" "+response.statusText});var n=function(t){var n=new Array(2);n=o(e.data);var a=new Date;a.setFullYear(e.year);for(var s=0;s<2;s++){for(var i=0;i<=11;i++){for(var l=0,c=0;c<t.length;c++)i===new Date(t[c].sales_date).getMonth()&&a.getFullYear()===new Date(t[c].sales_date).getFullYear()&&(l+=t[c].project_price);n[s][i]=l}e.series.push(a.getFullYear().toString()),a.setFullYear(a.getFullYear()-1)}return n};e.changeYear=function(){t.getSales().query().$promise.then(function(t){e.data=n(t)},function(t){e.message="Error: "+response.status+" "+response.statusText})}}]).controller("HeaderController",["$scope","$state","$rootScope","ngDialog","AuthFactory",function(e,t,o,n,a){e.loggedIn=!1,e.username="",a.isAuthenticated()&&(e.loggedIn=!0,e.username=a.getUsername()),e.openLogin=function(){n.open({template:"views/login.html",scope:e,className:"ngdialog-theme-default",controller:"LoginController"})},e.logOut=function(){a.logout(),e.loggedIn=!1,e.username=""},o.$on("login:Successful",function(){e.loggedIn=a.isAuthenticated(),e.username=a.getUsername()}),o.$on("registration:Successful",function(){e.loggedIn=a.isAuthenticated(),e.username=a.getUsername()}),e.stateis=function(e){return t.is(e)}}]).controller("LoginController",["$scope","ngDialog","$localStorage","AuthFactory",function(e,t,o,n){e.loginData=o.getObject("userinfo","{}"),e.doLogin=function(){e.rememberMe&&o.storeObject("userinfo",e.loginData),n.login(e.loginData),t.close()},e.openRegister=function(){t.open({template:"views/register.html",scope:e,className:"ngdialog-theme-default",controller:"RegisterController"})}}]).controller("RegisterController",["$scope","ngDialog","$localStorage","AuthFactory",function(e,t,o,n){e.register={},e.loginData={},e.doRegister=function(){console.log("Doing registration",e.registration),n.register(e.registration),t.close()}}]),angular.module("myApp").constant("baseURL","http://ec2-35-158-94-35.eu-central-1.compute.amazonaws.com:8080/").service("actionsService",["$resource","baseURL",function(e,t){this.getActions=function(){return e(t+"actions/:id",null,{update:{method:"PUT"},post:{method:"POST"}})}}]).service("panelService",function(){this.getPanels=function(){return[{id:0,icon:"fa fa-comment-o fa-4x",title:"Define Action",text:"This is the first step of the cycle. You have to describe the action that you have in mind and choose the client that you want to make the action. Also put a dead line for all the cycle.",collapse:"collapseOne"},{id:1,icon:"glyphicon glyphicon-earphone fa-4x",title:"Prospect Action",text:"Prospection is the second step of the cycle. In this phase the objective is to set  a meeting with a client to present our products or services. First of all think about the meeting objective and the strategy. What and why would you like to present or expose the products/services to the client?.Â¿Why the client would buy your porducts?.... Second you have to chose from the client the concret contact for the action. When you chose the contact you will see all the information you need to concret a meeting. To finish this phase you will have to stablish the meeting with the contact an fullfill  the field (meeting date). If you can arrenge the meeting close the action",collapse:"collapseTwo"},{id:2,icon:"glyphicon glyphicon-import fa-4x",title:"Request Action",text:"Now you made the meeting with the client. So If the client request some product or service or you have seen an oportunity is time to resum the meeting and after start to prepare the offer. If the client not want anythig now close the action and explain your feelings.",collapse:"collapseThree"},{id:3,icon:"glyphicon glyphicon-send fa-4x",title:"Response Action",text:"Response, in this phase you have to update information about the concret offer for the client. You update the offer, the budget, the margin ... If finally it is not possbile to develop the offer for any reasons close the action and set the feedback. If you send the offer, the client say to you if you are the winner or not. So you have to close the action and update the information fullfill the fields. If all the process go well and you win a sale you can see in the sales section",collapse:"collapseFour"}]}}).service("clientsService",["$resource","baseURL",function(e,t){this.getClients=function(){return e(t+"clients/:id",null,{update:{method:"PUT"}})}}]).service("salesService",["$resource","baseURL",function(e,t){this.getSales=function(){return e(t+"sales/:id",null,{post:{method:"POST"}})}}]).factory("$localStorage",["$window",function(e){return{store:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},remove:function(t){e.localStorage.removeItem(t)},storeObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t,o){return JSON.parse(e.localStorage[t]||o)}}}]).factory("AuthFactory",["$resource","$http","$localStorage","$rootScope","$window","baseURL","ngDialog","$state",function(e,t,o,n,a,s,i,l){function c(e){o.storeObject(d,e),r(e)}function r(e){g=!0,f=e.username,h=e.token,t.defaults.headers.common["x-access-token"]=h}function u(){h=void 0,f="",g=!1,t.defaults.headers.common["x-access-token"]=h,o.remove(d)}var p={},d="Token",g=!1,f="",h=void 0;return p.login=function(t){e(s+"users/login").save(t,function(e){c({username:t.username,token:e.token}),n.$broadcast("login:Successful"),l.go("app.activeActions")},function(e){g=!1;var t='<div class="ngdialog-message"><div><h3>Login Unsuccessful</h3></div><div><p>'+e.data.err.message+"</p><p>"+e.data.err.name+'</p></div><div class="ngdialog-buttons"><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click=confirm("OK")>OK</button></div>';i.openConfirm({template:t,plain:"true"})})},p.logout=function(){e(s+"users/logout").get(function(e){}),u()},p.register=function(t){e(s+"users/register").save(t,function(e){p.login({username:t.username,password:t.password}),t.rememberMe&&o.storeObject("userinfo",{username:t.username,password:t.password}),n.$broadcast("registration:Successful")},function(e){var t='<div class="ngdialog-message"><div><h3>Registration Unsuccessful</h3></div><div><p>'+e.data.err.message+"</p><p>"+e.data.err.name+"</p></div>";i.openConfirm({template:t,plain:"true"})})},p.isAuthenticated=function(){return g},p.getUsername=function(){return f},function(){var e=o.getObject(d,"{}");void 0!=e.username&&r(e)}(),p}]);
//# sourceMappingURL=app.min.js.map
